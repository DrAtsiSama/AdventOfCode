# --- Day 22: Monkey Market ---

As you're all teleported deep into the jungle, a monkey steals The Historians' device! You'll need to get it back while The Historians are looking for the Chief.

The monkey that stole the device seems willing to trade it, but only in exchange for an absurd number of bananas. Your only option is to buy bananas on the **Monkey Exchange Market**.

You aren't sure how the Monkey Exchange Market works, but one of The Historians senses trouble and comes over to help. Apparently, they've been studying these monkeys for a while and have deciphered their secrets.

---

## Understanding the Market

Today, the Market is full of monkeys buying good hiding spots. Fortunately, because of the time you recently spent in this jungle, you know lots of good hiding spots you can sell! If you sell enough hiding spots, you should be able to get enough bananas to buy the device back.

On the Market, the buyers seem to use random prices, but their prices are actually **pseudorandom**! If you know the secret of how they pick their prices, you can wait for the perfect time to sell.

---

## How Buyers Generate Prices

The part about secrets is literal, the Historian explains. Each buyer produces a pseudorandom sequence of secret numbers where each secret is derived from the previous.

In particular, each buyer's secret number evolves into the next secret number in the sequence via the following process:

1. Calculate the result of multiplying the secret number by 64. Then, mix this result into the secret number. Finally, prune the secret number.
2. Calculate the result of dividing the secret number by 32. Round the result down to the nearest integer. Then, mix this result into the secret number. Finally, prune the secret number.
3. Calculate the result of multiplying the secret number by 2048. Then, mix this result into the secret number. Finally, prune the secret number.

### Mixing and Pruning

Each step of the above process involves **mixing** and **pruning**:

- **Mixing**: Calculate the bitwise XOR of the given value and the secret number.  
  Example: If the secret number is `42` and you were to mix `15` into the secret number, the result becomes `37`.
- **Pruning**: Calculate the value of the secret number modulo `16777216`.  
  Example: If the secret number is `100000000`, the result becomes `16113920`.

---

## Example of Secret Numbers

If a buyer starts with a secret number of `123`, the buyer's next ten secret numbers would be:

```
15887950 16495136 527345 704524 1553684 12683156 11100544 12249484 7753432 5908254
```

---

## Puzzle Input

Each buyer uses their own secret number when choosing their price. Fortunately, the Historian's research has uncovered the initial secret number of each buyer:

```
1 10 100 2024
```


For each buyer, simulate the creation of 2000 new secret numbers. What is the sum of the 2000th secret number generated by each buyer?

---

### Example Output for Part 1:

For each buyer:

- `1`: 8685429
- `10`: 4700978
- `100`: 15273692
- `2024`: 8667524

Adding these results: `37327623`.

---

## --- Part Two ---

Of course, the secret numbers aren't the prices each buyer is offering! That would be ridiculous. Instead, the prices the buyer offers are just the **ones digit** of each of their secret numbers.

If a buyer starts with a secret number of `123`, their prices would be:

```
3 (from 123) 0 (from 15887950) 6 (from 16495136) 5 4 4 6 4 4 2
```

This price is the number of bananas the buyer is offering in exchange for your information about a new hiding spot.

---

## Selling Strategy

The monkey will only sell when it sees a specific sequence of **four consecutive changes** in price.  
For example, the sequence `-1, -1, 0, 2`.

### Example:

For the buyer starting with `123`:

| Secret Number | Price | Change |
|---------------|-------|--------|
| 123           | 3     |        |
| 15887950      | 0     | -3     |
| 16495136      | 6     | 6      |
| 527345        | 5     | -1     |
| 704524        | 4     | -1     |
| 1553684       | 4     | 0      |
| 12683156      | 6     | 2      |
| 11100544      | 4     | -2     |
| 12249484      | 4     | 0      |
| 7753432       | 2     | -2     |

---

### Goal for Part 2:

Find the sequence of price changes that will maximize the number of bananas obtained. Each buyer generates 2000 price changes, and you can only provide one sequence for all buyers.

### Example Input:

```
1 2 3 2024
```


### Example Optimal Sequence:

`-2, 1, -1, 3`

Results:

- Buyer `1`: Price = `7`  
- Buyer `2`: Price = `7`  
- Buyer `3`: Does not match sequence.  
- Buyer `2024`: Price = `9`.

Total: **23 bananas**.

---

## Final Puzzle Outputs:

- **Part 1**: `13022553808`
- **Part 2**: `1555`
